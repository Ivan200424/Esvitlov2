# –ü—ñ–¥—Å—É–º–æ–∫ –∑–º—ñ–Ω –¥–ª—è PR / Summary of Changes

## –î–∞—Ç–∞: 03.02.2026

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç—Ä–∏ –∑–º—ñ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–º–æ–≥:

## 1. ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è IP-–∞–¥—Ä–µ—Å–∏

**–§–∞–π–ª:** `src/handlers/settings.js`

### –ó–º—ñ–Ω–∏:
- –î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `isValidIP(ip)` –∑ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ—é –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ–±—ñ–ª—ñ–≤ (trim)
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–±—ñ–ª–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ IP
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É IPv4 —á–µ—Ä–µ–∑ regex
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ–∞–ø–∞–∑–æ–Ω—É 0-255 –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –æ–∫—Ç–µ—Ç—É
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
```javascript
‚úÖ '192.168.1.1' ‚Üí { valid: true, ip: '192.168.1.1' }
‚úÖ '  192.168.1.1  ' ‚Üí { valid: true, ip: '192.168.1.1' }
‚ùå '192.168. 1.1' ‚Üí { valid: false, error: 'IP-–∞–¥—Ä–µ—Å–∞ –Ω–µ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏' }
‚ùå '256.1.1.1' ‚Üí { valid: false, error: '–ö–æ–∂–Ω–µ —á–∏—Å–ª–æ –≤ IP-–∞–¥—Ä–µ—Å—ñ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 0 –¥–æ 255' }
‚ùå '192.168.1' ‚Üí { valid: false, error: '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç IP-–∞–¥—Ä–µ—Å–∏. –ü—Ä–∏–∫–ª–∞–¥: 192.168.1.1' }
```

## 2. ‚úÖ –ù–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∫–∞–Ω–∞–ª—É

**–§–∞–π–ª–∏:** `src/formatter.js`, `src/publisher.js`

### –î–æ–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è:
```javascript
formatScheduleForChannel(region, queue, scheduleData, updateDate, updateTime)
```

### –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:
- HTML —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∑ `<i>` —Ç–∞ `<b>` —Ç–µ–≥–∞–º–∏
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `<i>üí° –û–Ω–æ–≤–ª–µ–Ω–æ –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å <b>–Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ, –î–ê–¢–ê (–î–ï–ù–¨),</b> –¥–ª—è —á–µ—Ä–≥–∏ X:</i>`
- –ü–µ—Ä—ñ–æ–¥–∏: `ü™´ <b>00:00 - 06:00 (~6 –≥–æ–¥)</b>`
- –ó–∞–≥–∞–ª–æ–º: `–ó–∞–≥–∞–ª–æ–º –±–µ–∑ —Å–≤—ñ—Ç–ª–∞:<b> ~17 –≥–æ–¥</b>`
- –§—É—Ç–µ—Ä: `<i>–û–Ω–æ–≤–ª–µ–Ω–æ DD.MM.YYYY –æ <b>HH:MM</b> –î–¢–ï–ö</i>`

### –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è:
- `publisher.js` –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞/—á–∞—Å –¥–ª—è —Ñ—É—Ç–µ—Ä–∞ –î–¢–ï–ö
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `parse_mode: 'HTML'` –¥–ª—è –∫–∞–Ω–∞–ª—É

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:
```
üí° –û–Ω–æ–≤–ª–µ–Ω–æ –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ, 03.02.2026 (–í—ñ–≤—Ç–æ—Ä–æ–∫), –¥–ª—è —á–µ—Ä–≥–∏ 3.1:

ü™´ 06:00 - 12:00 (~6 –≥–æ–¥)
ü™´ 18:00 - 22:00 (~4 –≥–æ–¥)
–ó–∞–≥–∞–ª–æ–º –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: ~10 –≥–æ–¥

–û–Ω–æ–≤–ª–µ–Ω–æ 03.02.2026 –æ 15:30 –î–¢–ï–ö
```

## 3. ‚úÖ –§–æ—Ä–º–∞—Ç –¥–ª—è –±–æ—Ç–∞ (–ø—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç)

**–§–∞–π–ª:** `src/formatter.js`

### –î–æ–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è:
```javascript
formatScheduleForBot(region, queue, scheduleData)
```

### –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:
- –ë–ï–ó HTML —Ç–µ–≥—ñ–≤ (–ø—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç)
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `üí° –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ, –î–ê–¢–ê (–î–ï–ù–¨), –¥–ª—è —á–µ—Ä–≥–∏ X:`
- –ü–µ—Ä—ñ–æ–¥–∏: `ü™´ 00:00 - 06:00 (~6 –≥–æ–¥)`
- –ó–∞–≥–∞–ª–æ–º: `–ó–∞–≥–∞–ª–æ–º –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: ~17 –≥–æ–¥`
- –ë–µ–∑ —Ñ—É—Ç–µ—Ä–∞ –î–¢–ï–ö

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:
```
üí° –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ, 03.02.2026 (–í—ñ–≤—Ç–æ—Ä–æ–∫), –¥–ª—è —á–µ—Ä–≥–∏ 3.1:

ü™´ 06:00 - 12:00 (~6 –≥–æ–¥)
ü™´ 18:00 - 22:00 (~4 –≥–æ–¥)
–ó–∞–≥–∞–ª–æ–º –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: ~10 –≥–æ–¥
```

## –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è

| –î–µ | –§–æ—Ä–º–∞—Ç | –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ |
|----|--------|-------------|
| **–ö–∞–Ω–∞–ª** (–∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è) | HTML (`<i>`, `<b>`) | "–û–Ω–æ–≤–ª–µ–Ω–æ –≥—Ä–∞—Ñ—ñ–∫...", –∫—É—Ä—Å–∏–≤ + –∂–∏—Ä–Ω–∏–π, —Ñ—É—Ç–µ—Ä –∑ –¥–∞—Ç–æ—é –î–¢–ï–ö |
| **–ë–æ—Ç** (–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è) | –ü—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç | "–ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å...", –±–µ–∑ HTML, –±–µ–∑ —Ñ—É—Ç–µ—Ä–∞ |

## –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏

1. `src/handlers/settings.js` (51 —Ä—è–¥–∫—ñ–≤ –∑–º—ñ–Ω–µ–Ω–æ)
   - –î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `isValidIP`
   - –û–Ω–æ–≤–ª–µ–Ω–æ `handleIpConversation` –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

2. `src/formatter.js` (120 —Ä—è–¥–∫—ñ–≤ –¥–æ–¥–∞–Ω–æ)
   - –î–æ–¥–∞–Ω–æ `formatScheduleForChannel`
   - –î–æ–¥–∞–Ω–æ `formatScheduleForBot`
   - –û–Ω–æ–≤–ª–µ–Ω–æ –µ–∫—Å–ø–æ—Ä—Ç –º–æ–¥—É–ª—è

3. `src/publisher.js` (20 —Ä—è–¥–∫—ñ–≤ –∑–º—ñ–Ω–µ–Ω–æ)
   - –î–æ–¥–∞–Ω–æ —ñ–º–ø–æ—Ä—Ç `formatScheduleForChannel`
   - –û–Ω–æ–≤–ª–µ–Ω–æ `publishScheduleWithPhoto` –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
   - –î–æ–¥–∞–Ω–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é updateDate —Ç–∞ updateTime

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

‚úÖ –í—Å—ñ —Ñ–∞–π–ª–∏ –º–∞—é—Ç—å –≤–∞–ª—ñ–¥–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
‚úÖ –§—É–Ω–∫—Ü—ñ—ó –µ–∫—Å–ø–æ—Ä—Ç—É—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
‚úÖ IP –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î –∑ —É—Å—ñ–º–∞ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º–∏
‚úÖ –§–æ—Ä–º–∞—Ç –∫–∞–Ω–∞–ª—É –≥–µ–Ω–µ—Ä—É—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π HTML
‚úÖ –§–æ—Ä–º–∞—Ç –±–æ—Ç–∞ –≥–µ–Ω–µ—Ä—É—î –ø—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç
‚úÖ –ù–µ –ø–æ—Ä—É—à–µ–Ω–æ —ñ—Å–Ω—É—é—á–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª

## –í–∏–º–æ–≥–∏

‚úÖ 1. –ù–µ –ª–∞–º–∞—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª - –î–æ—Ç—Ä–∏–º–∞–Ω–æ
‚úÖ 2. –í–∞–ª—ñ–¥–∞—Ü—ñ—è IP –º–∞—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–º–∏–ª–∫–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é - –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
‚úÖ 3. –í –∫–∞–Ω–∞–ª—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `parse_mode: 'HTML'` - –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

---

**–°—Ç–∞—Ç—É—Å:** –í—Å—ñ —Ç—Ä–∏ –∑–º—ñ–Ω–∏ —É—Å–ø—ñ—à–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ç–∞ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ
