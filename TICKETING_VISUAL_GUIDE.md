# Visual Guide - Ticketing System User Flow

## User Flow: Submitting Feedback

### Step 1: Open Help Menu
```
User clicks: –ú–µ–Ω—é ‚Üí –î–æ–ø–æ–º–æ–≥–∞ ‚Üí üí¨ –ó–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫
```

**Bot displays:**
```
üí¨ –ó–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫

–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –≤–∞—à–æ–≥–æ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è:

[üêõ –ë–∞–≥]
[üí° –Ü–¥–µ—è]
[üí¨ –Ü–Ω—à–µ]
[‚Üê –ù–∞–∑–∞–¥]
```

### Step 2: Select Type
```
User clicks: üêõ –ë–∞–≥
```

**Bot displays:**
```
üêõ –ë–∞–≥

–ù–∞–¥—ñ—à–ª—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ –∞–±–æ –≤—ñ–¥–µ–æ).

‚è± –£ –≤–∞—Å —î 5 —Ö–≤–∏–ª–∏–Ω –Ω–∞ –≤–≤–µ–¥–µ–Ω–Ω—è.

[‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏]
```

### Step 3: Send Message
```
User sends: "–ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞"
OR
User sends: Photo with caption "–û—Å—å —Å–∫—Ä—ñ–Ω—à–æ—Ç –ø–æ–º–∏–ª–∫–∏"
OR
User sends: Video
```

**Bot displays preview:**
```
üêõ –ë–∞–≥

üìù –í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
–ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞

–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ü–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è?

[‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏] [‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏]
```

### Step 4: Confirm
```
User clicks: ‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏
```

**Bot confirms:**
```
‚úÖ –î—è–∫—É—î–º–æ –∑–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è!

–í–∞—à–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è #123 –ø—Ä–∏–π–Ω—è—Ç–æ.
–ú–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –π–æ–≥–æ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.
```

**Admins receive notification:**
```
üé´ –ù–æ–≤–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è #123

üêõ –¢–∏–ø: –ë–∞–≥
üë§ –í—ñ–¥: @username (ID: 1234567890)
üìÖ –î–∞—Ç–∞: 11.02.2026, 08:27:45

üìù –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
–ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞

[üì© –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏]
```

---

## User Flow: Region Request

### Step 1: Open Help Menu
```
User clicks: –ú–µ–Ω—é ‚Üí –î–æ–ø–æ–º–æ–≥–∞ ‚Üí üèô –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–≥—ñ–æ–Ω
```

**Bot displays:**
```
üèô –ó–∞–ø–∏—Ç –Ω–∞ –Ω–æ–≤–∏–π —Ä–µ–≥—ñ–æ–Ω

–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞ –∞–±–æ —Ä–µ–≥—ñ–æ–Ω—É, —è–∫–∏–π –≤–∏ —Ö–æ—á–µ—Ç–µ –¥–æ–¥–∞—Ç–∏.

–ü—Ä–∏–∫–ª–∞–¥: –ñ–∏—Ç–æ–º–∏—Ä, –í—ñ–Ω–Ω–∏—Ü—è, –ß–µ—Ä–∫–∞—Å–∏

‚è± –£ –≤–∞—Å —î 5 —Ö–≤–∏–ª–∏–Ω –Ω–∞ –≤–≤–µ–¥–µ–Ω–Ω—è.

[‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏]
```

### Step 2: Enter Region Name
```
User sends: "–ñ–∏—Ç–æ–º–∏—Ä"
```

**Bot displays preview:**
```
üèô –ó–∞–ø–∏—Ç –Ω–∞ –Ω–æ–≤–∏–π —Ä–µ–≥—ñ–æ–Ω

üìç –†–µ–≥—ñ–æ–Ω: –ñ–∏—Ç–æ–º–∏—Ä

–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Ç?

[‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏] [‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏]
```

### Step 3: Confirm
```
User clicks: ‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏
```

**Bot confirms:**
```
‚úÖ –î—è–∫—É—î–º–æ –∑–∞ –∑–∞–ø–∏—Ç!

–í–∞—à –∑–∞–ø–∏—Ç #124 –Ω–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–≥—ñ–æ–Ω—É "–ñ–∏—Ç–æ–º–∏—Ä" –ø—Ä–∏–π–Ω—è—Ç–æ.

–ú–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –π–æ–≥–æ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.
```

**Admins receive notification:**
```
üèô –ó–∞–ø–∏—Ç –Ω–∞ –Ω–æ–≤–∏–π —Ä–µ–≥—ñ–æ–Ω #124

üìç –†–µ–≥—ñ–æ–Ω: –ñ–∏—Ç–æ–º–∏—Ä
üë§ –í—ñ–¥: @username (ID: 1234567890)
üìÖ –î–∞—Ç–∞: 11.02.2026, 08:30:12

[üì© –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏]
```

---

## Admin Flow: Managing Tickets

### Step 1: Open Admin Panel
```
Admin clicks: /admin ‚Üí üì© –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è (3)
```

**Bot displays:**
```
üì© –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è

–í—ñ–¥–∫—Ä–∏—Ç–∏—Ö –∑–≤–µ—Ä–Ω–µ–Ω—å: 3

–û–±–µ—Ä—ñ—Ç—å –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É:

[üÜï üêõ #123 - –ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞]
[üÜï üèô #124 - –ó–∞–ø–∏—Ç –Ω–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–≥—ñ–æ–Ω—É: –ñ–∏—Ç...]
[üÜï üí¨ #122 - –î—è–∫—É—é –∑–∞ –±–æ—Ç–∞!]

[‚Üê –ù–∞–∑–∞–¥] [‚§¥ –ú–µ–Ω—é]
```

### Step 2: View Ticket
```
Admin clicks: [üÜï üêõ #123 - –ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞]
```

**Bot displays:**
```
üì© –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è #123

üêõ –ë–∞–≥
üÜï –í—ñ–¥–∫—Ä–∏—Ç–æ
üë§ –í—ñ–¥: 1234567890
üìÖ –°—Ç–≤–æ—Ä–µ–Ω–æ: 11.02.2026, 08:27:45
üìù –¢–µ–º–∞: –ë–∞–≥

–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:

üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:
–ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞

[üí¨ –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏] [‚úÖ –ó–∞–∫—Ä–∏—Ç–∏]
[‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É]
```

### Step 3: Close Ticket
```
Admin clicks: [‚úÖ –ó–∞–∫—Ä–∏—Ç–∏]
```

**Bot updates view:**
```
üì© –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è #123

üêõ –ë–∞–≥
‚úÖ –ó–∞–∫—Ä–∏—Ç–æ
üë§ –í—ñ–¥: 1234567890
üìÖ –°—Ç–≤–æ—Ä–µ–Ω–æ: 11.02.2026, 08:27:45
üìù –¢–µ–º–∞: –ë–∞–≥

–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:

üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:
–ù–µ –ø—Ä–∞—Ü—é—î –∫–Ω–æ–ø–∫–∞ —Ç–∞–π–º–µ—Ä–∞

[üîÑ –í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–Ω–æ–≤—É]
[‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É]
```

**User receives notification:**
```
‚úÖ –í–∞—à–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è #123 –∑–∞–∫—Ä–∏—Ç–æ

–î—è–∫—É—î–º–æ –∑–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è!
```

---

## Edge Cases Handled

### Timeout (5 minutes)
```
User opens feedback form but doesn't send message within 5 minutes
```

**Bot notifies:**
```
‚è± –ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –º–∏–Ω—É–≤. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É, –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "üí¨ –ó–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫".
```

### Cancel
```
User clicks: [‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏] at any step
```

**Bot confirms:**
```
‚ùå –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ.
```

### Invalid Media Type
```
User sends audio or document instead of text/photo/video
```

**Bot notifies:**
```
‚ùå –ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ —Ç–∞ –≤—ñ–¥–µ–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.
```

### Region Name Too Short/Long
```
User enters "A" or 200-character string
```

**Bot notifies:**
```
‚ùå –ù–∞–∑–≤–∞ —Ä–µ–≥—ñ–æ–Ω—É –∑–∞–Ω–∞–¥—Ç–æ –∫–æ—Ä–æ—Ç–∫–∞/–¥–æ–≤–≥–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.
```

---

## Database Structure

### tickets table
```
+---------------+-----------+--------------------+
| Column        | Type      | Description        |
+---------------+-----------+--------------------+
| id            | SERIAL    | Primary key        |
| telegram_id   | TEXT      | User's Telegram ID |
| type          | TEXT      | feedback/bug/...   |
| status        | TEXT      | open/closed        |
| subject       | TEXT      | Brief description  |
| created_at    | TIMESTAMP | When created       |
| updated_at    | TIMESTAMP | Last update        |
| closed_at     | TIMESTAMP | When closed        |
| closed_by     | TEXT      | Admin who closed   |
+---------------+-----------+--------------------+
```

### ticket_messages table
```
+---------------+-----------+--------------------+
| Column        | Type      | Description        |
+---------------+-----------+--------------------+
| id            | SERIAL    | Primary key        |
| ticket_id     | INTEGER   | FK to tickets      |
| sender_type   | TEXT      | user/admin         |
| sender_id     | TEXT      | Telegram ID        |
| message_type  | TEXT      | text/photo/video   |
| content       | TEXT      | Message text       |
| file_id       | TEXT      | Telegram file ID   |
| created_at    | TIMESTAMP | When sent          |
+---------------+-----------+--------------------+
```

---

## Key Features

‚úÖ **Multi-type Support**: Bug reports, feature ideas, general feedback, region requests
‚úÖ **Media Support**: Text, photos, and videos
‚úÖ **Timeout Protection**: 5-minute timeout prevents abandoned sessions
‚úÖ **Preview & Confirm**: Users can review before sending
‚úÖ **Admin Notifications**: All admins notified immediately
‚úÖ **Ticket Management**: View, close, reopen tickets
‚úÖ **User Notifications**: Users notified when tickets are closed
‚úÖ **Pagination**: Ticket list supports pagination (5 per page)
‚úÖ **Message History**: Full conversation history per ticket

---

## Technical Details

### State Management
- Uses centralized `stateManager` with type: `feedback` or `regionRequest`
- Automatic cleanup after timeout or completion
- State persisted to database for recovery

### Security
- All inputs validated
- Parameterized SQL queries
- Admin-only access controls
- No file downloads (only file_id references)

### Performance
- Indexed columns for fast lookups
- Efficient pagination
- Minimal database queries

### User Experience
- Ukrainian language throughout
- Clear instructions
- Immediate feedback
- Cancel option at every step
- Mobile-friendly inline keyboards
