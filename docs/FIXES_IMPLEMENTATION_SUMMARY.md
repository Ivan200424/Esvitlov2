# –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å: –ü–æ–¥–≤—ñ–π–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ö–µ—à—ñ–≤ —Ç–∞ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å

## –û–≥–ª—è–¥

–¶–µ–π PR –≤–∏—Ä—ñ—à—É—î —Ç—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤ –±–æ—Ç—ñ Voltyk:

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ–¥–≤—ñ–π–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ö–µ—à—ñ–≤ –±–ª–æ–∫—É—î –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é –≤ –∫–∞–Ω–∞–ª

**–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- Scheduler: "–•–µ—à –Ω–æ–≤–∏–π ‚Üí –ø—É–±–ª—ñ–∫—É—î–º–æ!"
- Publisher: "Snapshot –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ!"
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –π–¥–µ –≤ –±–æ—Ç, –∞–ª–µ –ù–ï –≤ –∫–∞–Ω–∞–ª ‚ùå

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- Scheduler –ø–µ—Ä–µ–¥–∞—î `force: true` –¥–æ Publisher
- Publisher: "Force mode ‚Üí –ø—É–±–ª—ñ–∫—É—î–º–æ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ snapshot!"
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –π–¥–µ —ñ –≤ –±–æ—Ç, —ñ –≤ –∫–∞–Ω–∞–ª ‚úÖ

**–ó–º—ñ–Ω–∏ –≤ –∫–æ–¥—ñ:**

`src/publisher.js`:
```javascript
// –î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä force –∑ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º false
async function publishScheduleWithPhoto(bot, user, region, queue, { force = false } = {}) {
  // ...
  
  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ snapshot —Ç–µ–ø–µ—Ä –≤—Ä–∞—Ö–æ–≤—É—î force
  if (!force && !updateTypeV2.todayChanged && !updateTypeV2.tomorrowChanged) {
    console.log(`[${user.telegram_id}] Snapshots unchanged, skipping publication`);
    return null;
  }
  // Snapshot —Ö–µ—à—ñ –≤—Å–µ –æ–¥–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ
}
```

`src/scheduler.js`:
```javascript
// Scheduler —Ç–µ–ø–µ—Ä –ø–µ—Ä–µ–¥–∞—î force: true
const sentMsg = await publishScheduleWithPhoto(bot, user, user.region, user.queue, { force: true });
```

`src/handlers/settings.js`:
```javascript
// –¢–µ—Å—Ç–æ–≤–∞ –∫–Ω–æ–ø–∫–∞ —Ç–∞–∫–æ–∂ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î force: true
await publishScheduleWithPhoto(bot, user, user.region, user.queue, { force: true });
```

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è "–ö—É–¥–∏ —Å–ø–æ–≤—ñ—â–∞—Ç–∏" –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –∑ –º–µ–Ω—é

**–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –ú–µ–Ω—é "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è" –ø–æ–∫–∞–∑—É—î –ª–∏—à–µ –≤–∏–º–∫/—É–≤—ñ–º–∫
- –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≤–∏–±–æ—Ä—É (–±–æ—Ç/–∫–∞–Ω–∞–ª/–æ–±–∏–¥–≤–∞) —ñ—Å–Ω—É—î, –∞–ª–µ –Ω–µ–º–∞—î –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ –∫—É–¥–∏ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è ‚ùå

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–µ –º–µ–Ω—é –æ–±'—î–¥–Ω—É—î –≤—Å–µ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ
- –ü—Ä–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è—Ö –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –æ–ø—Ü—ñ—ó
- –Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚úÖ

**UI –∫–æ–ª–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ:**
```
üîî –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è

–°—Ç–∞—Ç—É—Å: ‚úÖ –£–≤—ñ–º–∫–Ω–µ–Ω–æ
–ö—É–¥–∏: üì±üì∫ –í –±–æ—Ç —ñ –∫–∞–Ω–∞–ª

[üì± –¢—ñ–ª—å–∫–∏ –≤ –±–æ—Ç]
[üì∫ –¢—ñ–ª—å–∫–∏ –≤ –∫–∞–Ω–∞–ª]
[‚úì üì±üì∫ –í –±–æ—Ç —ñ –∫–∞–Ω–∞–ª]  ‚Üê –ü–æ—Ç–æ—á–Ω–∏–π –≤–∏–±—ñ—Ä –≤—ñ–¥–º—ñ—á–µ–Ω–æ
[üîï –í–∏–º–∫–Ω—É—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è]
[‚Üê –ù–∞–∑–∞–¥]
```

**UI –∫–æ–ª–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–æ:**
```
üîî –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è

–°—Ç–∞—Ç—É—Å: ‚ùå –í–∏–º–∫–Ω–µ–Ω–æ

[üîî –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è]
[‚Üê –ù–∞–∑–∞–¥]
```

**–ó–º—ñ–Ω–∏ –≤ –∫–æ–¥—ñ:**

`src/keyboards/inline.js`:
```javascript
// –ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ—ó –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
function getUnifiedAlertsKeyboard(isActive, currentTarget = 'both') {
  const buttons = [];
  
  if (isActive) {
    // –ü–æ–∫–∞–∑—É—î–º–æ –≤–∏–±—ñ—Ä —Ü—ñ–ª—ñ –∫–æ–ª–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ
    const options = [
      { value: 'bot', label: 'üì± –¢—ñ–ª—å–∫–∏ –≤ –±–æ—Ç' },
      { value: 'channel', label: 'üì∫ –¢—ñ–ª—å–∫–∏ –≤ –∫–∞–Ω–∞–ª' },
      { value: 'both', label: 'üì±üì∫ –í –±–æ—Ç —ñ –∫–∞–Ω–∞–ª' }
    ];
    
    options.forEach(opt => {
      buttons.push([{
        text: currentTarget === opt.value ? `‚úì ${opt.label}` : opt.label,
        callback_data: `notify_target_${opt.value}`
      }]);
    });
    
    buttons.push([{ text: 'üîï –í–∏–º–∫–Ω—É—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', callback_data: 'alert_toggle' }]);
  } else {
    // –ö–æ–ª–∏ –≤–∏–º–∫–Ω–µ–Ω–æ - –ª–∏—à–µ –∫–Ω–æ–ø–∫–∞ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è
    buttons.push([{ text: 'üîî –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', callback_data: 'alert_toggle' }]);
  }
  
  buttons.push([{ text: '‚Üê –ù–∞–∑–∞–¥', callback_data: 'back_to_settings' }]);
  
  return { reply_markup: { inline_keyboard: buttons } };
}
```

`src/handlers/settings.js`:
```javascript
// –û–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ settings_alerts
if (data === 'settings_alerts') {
  const currentTarget = user.power_notify_target || 'both';
  const targetLabels = {
    'bot': 'üì± –¢—ñ–ª—å–∫–∏ –≤ –±–æ—Ç',
    'channel': 'üì∫ –¢—ñ–ª—å–∫–∏ –≤ –∫–∞–Ω–∞–ª',
    'both': 'üì±üì∫ –í –±–æ—Ç —ñ –∫–∞–Ω–∞–ª'
  };
  
  let message = `üîî <b>–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</b>\n\n`;
  message += `–°—Ç–∞—Ç—É—Å: <b>${user.is_active ? '‚úÖ –£–≤—ñ–º–∫–Ω–µ–Ω–æ' : '‚ùå –í–∏–º–∫–Ω–µ–Ω–æ'}</b>\n`;
  
  if (user.is_active) {
    message += `–ö—É–¥–∏: <b>${targetLabels[currentTarget]}</b>\n\n`;
    message += '–í–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ:\n‚Ä¢ –ó–º—ñ–Ω–∏ –≥—Ä–∞—Ñ—ñ–∫–∞\n‚Ä¢ –§–∞–∫—Ç–∏—á–Ω—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è';
  }
  
  await safeEditMessageText(bot, message, {
    chat_id: chatId,
    message_id: query.message.message_id,
    parse_mode: 'HTML',
    reply_markup: getUnifiedAlertsKeyboard(user.is_active, currentTarget).reply_markup,
  });
}

// –û–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ alert_toggle –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º –º–µ–Ω—é
// –û–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ notify_target_* –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –º–µ–Ω—é
// –í–∏–¥–∞–ª–µ–Ω–æ –æ–∫—Ä–µ–º–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ settings_notify_target
```

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 3: Wizard –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –¥–µ—Ñ–æ–ª—Ç –¥–ª—è –∫–∞–Ω–∞–ª—É

**–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î "–£ Telegram-–∫–∞–Ω–∞–ª—ñ" –≤ wizard
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–∏—Ç—å `power_notify_target = 'channel'` (—Ç—ñ–ª—å–∫–∏ –∫–∞–Ω–∞–ª)
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ù–ï –æ—Ç—Ä–∏–º—É—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –±–æ—Ç ‚ùå

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î "–£ Telegram-–∫–∞–Ω–∞–ª—ñ" –≤ wizard
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–∏—Ç—å `power_notify_target = 'both'` (—ñ –±–æ—Ç, —ñ –∫–∞–Ω–∞–ª)
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –æ–±–æ—Ö –º—ñ—Å—Ü—è—Ö ‚úÖ

**–õ–æ–≥—ñ–∫–∞:**
–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –∫–∞–Ω–∞–ª, —Ü–µ –æ–∑–Ω–∞—á–∞—î —â–æ –≤—ñ–Ω —Ö–æ—á–µ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª, –∞ –Ω–µ –∑–∞–º—ñ—Å—Ç—å –±–æ—Ç–∞.

**–ó–º—ñ–Ω–∏ –≤ –∫–æ–¥—ñ:**

`src/handlers/start.js`:
```javascript
if (data === 'wizard_notify_channel') {
  // ... –∫–æ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ ...
  
  if (existingUser) {
    await usersDb.updateUserRegionAndQueue(telegramId, state.region, state.queue);
    // –ó–º—ñ–Ω–µ–Ω–æ –∑ 'channel' –Ω–∞ 'both'
    await usersDb.updateUserPowerNotifyTarget(telegramId, 'both');
  } else {
    // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ power_notify_target = 'both'
    await usersDb.createUser(telegramId, username, state.region, state.queue);
    await usersDb.updateUserPowerNotifyTarget(telegramId, 'both');
    
    // –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º
    await logUserRegistration(telegramId, { 
      region: state.region, 
      queue: state.queue, 
      username, 
      notify_target: 'both'  // –ó–º—ñ–Ω–µ–Ω–æ –∑ 'channel'
    });
  }
}
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏
–°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ—Å—Ç `test-fixes.js` —è–∫–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î:
1. ‚úÖ Publisher –º–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä `force` —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î
2. ‚úÖ Scheduler –ø–µ—Ä–µ–¥–∞—î `{ force: true }` –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É publisher
3. ‚úÖ Settings –ø–µ—Ä–µ–¥–∞—î `{ force: true }` –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –∫–Ω–æ–ø–∫–∏
4. ‚úÖ `getUnifiedAlertsKeyboard` —ñ—Å–Ω—É—î —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –µ–∫—Å–ø–æ—Ä—Ç—É—î—Ç—å—Å—è
5. ‚úÖ –£–≤—ñ–º–∫–Ω–µ–Ω–∏–π —Å—Ç–∞–Ω –ø–æ–∫–∞–∑—É—î –≤—Å—ñ 5+ –∫–Ω–æ–ø–æ–∫ (3 —Ü—ñ–ª—ñ + –≤–∏–º–∫ + –Ω–∞–∑–∞–¥)
6. ‚úÖ –í–∏–º–∫–Ω–µ–Ω–∏–π —Å—Ç–∞–Ω –ø–æ–∫–∞–∑—É—î 2 –∫–Ω–æ–ø–∫–∏ (—É–≤—ñ–º–∫ + –Ω–∞–∑–∞–¥)
7. ‚úÖ Settings –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—É –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É
8. ‚úÖ Wizard channel flow –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `'both'` –∑–∞–º—ñ—Å—Ç—å `'channel'`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å—ñ —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π—à–ª–∏ —É—Å–ø—ñ—à–Ω–æ ‚úÖ

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ–∫–∏
CodeQL –∞–Ω–∞–ª—ñ–∑ –Ω–µ –≤–∏—è–≤–∏–≤ –∂–æ–¥–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π ‚úÖ

### –†–µ–≥—Ä–µ—Å—ñ–π–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
–Ü—Å–Ω—É—é—á—ñ —Ç–µ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –±–µ–∑ –Ω–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ (—î pre-existing failures –Ω–µ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –Ω–∞—à–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏)

---

## –í–ø–ª–∏–≤

### –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ "–î–æ" —Ç–∞ "–ü—ñ—Å–ª—è"

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫–∞
**–î–æ:**
- Scheduler –±–∞—á–∏—Ç—å –Ω–æ–≤–∏–π —Ö–µ—à
- Scheduler –Ω–∞–¥—Å–∏–ª–∞—î –≤ –±–æ—Ç ‚úÖ
- Scheduler –≤–∏–∫–ª–∏–∫–∞—î Publisher –¥–ª—è –∫–∞–Ω–∞–ª—É
- Publisher –±–∞—á–∏—Ç—å –Ω–µ–∑–º—ñ–Ω–µ–Ω–∏–π snapshot
- Publisher –ø—Ä–æ–ø—É—Å–∫–∞—î –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é –≤ –∫–∞–Ω–∞–ª ‚ùå
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–Ω–∞–ª –Ω–µ –æ—Ç—Ä–∏–º—É—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

**–ü—ñ—Å–ª—è:**
- Scheduler –±–∞—á–∏—Ç—å –Ω–æ–≤–∏–π —Ö–µ—à
- Scheduler –Ω–∞–¥—Å–∏–ª–∞—î –≤ –±–æ—Ç ‚úÖ
- Scheduler –≤–∏–∫–ª–∏–∫–∞—î Publisher –∑ `force: true`
- Publisher —ñ–≥–Ω–æ—Ä—É—î snapshot –ø–µ—Ä–µ–≤—ñ—Ä–∫—É
- Publisher –ø—É–±–ª—ñ–∫—É—î –≤ –∫–∞–Ω–∞–ª ‚úÖ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –Ü –±–æ—Ç, —ñ –∫–∞–Ω–∞–ª –æ—Ç—Ä–∏–º—É—é—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
**–î–æ:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –π–¥–µ –≤ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è" ‚Üí "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è"
- –ë–∞—á–∏—Ç—å –ª–∏—à–µ –≤–∏–º–∫/—É–≤—ñ–º–∫
- –ù–µ –º–æ–∂–µ –≤–∏–±—Ä–∞—Ç–∏ –∫—É–¥–∏ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ (–±–æ—Ç/–∫–∞–Ω–∞–ª/–æ–±–∏–¥–≤–∞) ‚ùå

**–ü—ñ—Å–ª—è:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –π–¥–µ –≤ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è" ‚Üí "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è"
- –ë–∞—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å (—É–≤—ñ–º–∫/–≤–∏–º–∫)
- –ë–∞—á–∏—Ç—å –ø–æ—Ç–æ—á–Ω—É —Ü—ñ–ª—å (–±–æ—Ç/–∫–∞–Ω–∞–ª/–æ–±–∏–¥–≤–∞)
- –ú–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –≤—Å–µ –æ–¥–Ω–∏–º –∫–ª—ñ–∫–æ–º ‚úÖ

#### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: Wizard –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–∞–Ω–∞–ª—É
**–î–æ:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î "–£ Telegram-–∫–∞–Ω–∞–ª—ñ"
- –°–∏—Å—Ç–µ–º–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `power_notify_target = 'channel'`
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –π–¥—É—Ç—å –¢–Ü–õ–¨–ö–ò –≤ –∫–∞–Ω–∞–ª, –ù–ï –≤ –±–æ—Ç ‚ùå

**–ü—ñ—Å–ª—è:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î "–£ Telegram-–∫–∞–Ω–∞–ª—ñ"
- –°–∏—Å—Ç–µ–º–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `power_notify_target = 'both'`
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –π–¥—É—Ç—å –Ü –≤ –∫–∞–Ω–∞–ª, –Ü –≤ –±–æ—Ç ‚úÖ

---

## –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ

1. **src/publisher.js** (3 lines changed)
   - –î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `force` –¥–æ —Ñ—É–Ω–∫—Ü—ñ—ó `publishScheduleWithPhoto`
   - –û–Ω–æ–≤–ª–µ–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É snapshot –¥–ª—è –≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—è `force`

2. **src/scheduler.js** (1 line changed)
   - –ü–µ—Ä–µ–¥–∞—î—Ç—å—Å—è `{ force: true }` –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É publisher

3. **src/handlers/settings.js** (60+ lines changed)
   - –Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ `getUnifiedAlertsKeyboard`
   - –û–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `settings_alerts` –¥–ª—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –º–µ–Ω—é
   - –û–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `alert_toggle` –¥–ª—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –º–µ–Ω—é
   - –û–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `notify_target_*` –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –º–µ–Ω—é
   - –í–∏–¥–∞–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `settings_notify_target`
   - –î–æ–¥–∞–Ω–æ `{ force: true }` –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –∫–Ω–æ–ø–∫–∏
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –¥—Ä—É–∫–∞—Ä—Å—å–∫—É –ø–æ–º–∏–ª–∫—É

4. **src/keyboards/inline.js** (40+ lines added)
   - –î–æ–¥–∞–Ω–æ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é `getUnifiedAlertsKeyboard`
   - –ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é

5. **src/handlers/start.js** (6 lines changed)
   - –ó–º—ñ–Ω–µ–Ω–æ `'channel'` –Ω–∞ `'both'` —É –¥–≤–æ—Ö –º—ñ—Å—Ü—è—Ö wizard_notify_channel
   - –û–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º

---

## –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å

‚úÖ –í—Å—ñ –∑–º—ñ–Ω–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–≤–æ—Ä–æ—Ç–Ω–æ —Å—É–º—ñ—Å–Ω—ñ:
- –ü–∞—Ä–∞–º–µ—Ç—Ä `force` –º–∞—î –¥–µ—Ñ–æ–ª—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è `false`
- –§—É–Ω–∫—Ü—ñ—è `getNotifyTargetKeyboard` –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–ª—è –º–æ–∂–ª–∏–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —ñ–Ω—à–∏—Ö –º—ñ—Å—Ü—è—Ö
- –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –º—ñ–≥—Ä–∞—Ü—ñ—ó
- –Ü—Å–Ω—É—é—á—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞—é—Ç—å

---

## –ë–µ–∑–ø–µ–∫–∞

‚úÖ CodeQL –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–π–¥–µ–Ω–æ –±–µ–∑ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π
‚úÖ –ù–µ–º–∞—î —ñ–Ω º—î–∫—Ü—ñ–π –∞–±–æ XSS
‚úÖ –ù–µ–º–∞—î –≤–∏—Ç–æ–∫—É –¥–∞–Ω–∏—Ö
‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –ø—Ä–∏—Å—É—Ç–Ω—è

---

## –í–∏—Å–Ω–æ–≤–æ–∫

–í—Å—ñ —Ç—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏—Ä—ñ—à–µ–Ω—ñ –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏, —Ö—ñ—Ä—É—Ä–≥—ñ—á–Ω–æ —Ç–æ—á–Ω–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏ –≤ –∫–æ–¥–æ–≤—ñ–π –±–∞–∑—ñ. –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø–æ–∫—Ä–∞—â–µ–Ω–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥ —Å—Ç–∞–≤ –∫—Ä–∞—â–∏–º, —ñ –∫–æ–¥ —Å—Ç–∞–≤ —á–∏—Å—Ç—ñ—à–∏–º —Ç–∞ –∑—Ä–æ–∑—É–º—ñ–ª—ñ—à–∏–º.
