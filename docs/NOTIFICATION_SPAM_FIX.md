# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ —Å—Ç–∞–Ω —Å–≤—ñ—Ç–ª–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É–≤–∞–ª–∏ **3 —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—ñ–¥—Ä—è–¥** –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞–Ω—É —Å–≤—ñ—Ç–ª–∞ –∑–∞–º—ñ—Å—Ç—å –æ–¥–Ω–æ–≥–æ:

```
üü¢ 20:09 –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
üïì –ô–æ–≥–æ –Ω–µ –±—É–ª–æ 1 —Ö–≤

üî¥ 20:09 –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
üïì –í–æ–Ω–æ –±—É–ª–æ –º–µ–Ω—à–µ —Ö–≤–∏–ª–∏–Ω–∏
üóì –°–≤—ñ—Ç–ª–æ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è: 00:00

üü¢ 20:09 –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
üïì –ô–æ–≥–æ –Ω–µ –±—É–ª–æ –º–µ–Ω—à–µ —Ö–≤–∏–ª–∏–Ω–∏
```

### –ö–æ—Ä–µ–Ω–µ–≤—ñ –ø—Ä–∏—á–∏–Ω–∏

1. **–ü—Ä–∏ `debounce = 0` –Ω–µ–º–∞—î –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤**
   - `pendingState` —Å–∫–∏–¥–∞–≤—Å—è –≤ `null` –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏
   - –ü—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ —Å—Ç–∞–Ω –≤–∏–≥–ª—è–¥–∞–≤ —è–∫ "–Ω–æ–≤–∏–π"
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: 3 —à–≤–∏–¥–∫–∏—Ö –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è = 3 —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

2. **–ù–µ–º–∞—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ cooldown –º—ñ–∂ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏**
   - –ú—ñ–∂ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–º–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏ –Ω–µ –±—É–ª–æ –∑–∞—Ç—Ä–∏–º–∫–∏
   - –ú–æ–∂–ª–∏–≤—ñ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ `debounce > 0`

3. **–ù–µ–º–∞—î –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ "—Ñ–ª–∞–ø–ø—ñ–Ω–≥—É"**
   - –†–æ—É—Ç–µ—Ä –∫–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–æ "–±–ª–∏–º–∞—î" (on‚Üíoff‚Üíon –∑–∞ —Å–µ–∫—É–Ω–¥–∏)
   - –ë–æ—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –≤—Å—ñ –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É

## –†—ñ—à–µ–Ω–Ω—è

### 1. –î–æ–¥–∞–Ω–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π cooldown (60 —Å–µ–∫—É–Ω–¥)

**–§–∞–π–ª:** `src/powerMonitor.js`

**–ó–º—ñ–Ω–∏:**
- –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `lastNotificationAt` –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ `userState`
- –î–æ–¥–∞–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `NOTIFICATION_COOLDOWN_MS = 60 * 1000` (60 —Å–µ–∫—É–Ω–¥)
- –ü–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —á–∞—Å –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
- –Ø–∫—â–æ –ø—Ä–æ–π—à–ª–æ –º–µ–Ω—à–µ 60 —Å–µ–∫—É–Ω–¥ ‚Äî —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è
- –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞–Ω –≤—Å–µ –æ–¥–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ

**–ö–æ–¥:**
```javascript
// Check minimum cooldown to prevent notification spam
let shouldNotify = true;

if (userState.lastNotificationAt) {
  const timeSinceLastNotification = now - new Date(userState.lastNotificationAt);
  if (timeSinceLastNotification < NOTIFICATION_COOLDOWN_MS) {
    shouldNotify = false;
    const remainingSeconds = Math.ceil((NOTIFICATION_COOLDOWN_MS - timeSinceLastNotification) / 1000);
    console.log(`User ${user.id}: –ü—Ä–æ–ø—É—Å–∫ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —á–µ—Ä–µ–∑ cooldown (–∑–∞–ª–∏—à–∏–ª–æ—Å—å ${remainingSeconds}—Å)`);
  }
}
```

### 2. –î–æ–¥–∞–Ω–æ –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Ñ–ª–∞–ø–ø—ñ–Ω–≥—É –ø—Ä–∏ debounce=0

**–ó–º—ñ–Ω–∏:**
- –î–æ–¥–∞–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `MIN_STABILIZATION_MS = 30 * 1000` (30 —Å–µ–∫—É–Ω–¥)
- –ó–∞–º—ñ—Å—Ç—å –º–∏—Ç—Ç—î–≤–æ—ó –æ–±—Ä–æ–±–∫–∏ –ø—Ä–∏ `debounce=0`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ 30 —Å–µ–∫—É–Ω–¥
- –Ø–∫—â–æ —Å—Ç–∞–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∑–Ω–æ–≤—É ‚Äî —Ç–∞–π–º–µ—Ä —Å–∫–∞—Å–æ–≤—É—î—Ç—å—Å—è —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è
- –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ "–≤–∏–º–∫–Ω–µ–Ω–æ–º—É" debounce

**–ö–æ–¥:**
```javascript
// –í–∏–∑–Ω–∞—á–∞—î–º–æ —á–∞—Å –∑–∞—Ç—Ä–∏–º–∫–∏:
// - –Ø–∫—â–æ debounce = 0, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –∑–∞—Ç—Ä–∏–º–∫—É –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ —Ñ–ª–∞–ø–ø—ñ–Ω–≥—É
// - –Ü–Ω–∞–∫—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π debounce
let debounceMs;

if (debounceMinutes === 0) {
  debounceMs = MIN_STABILIZATION_MS;
  console.log(`User ${user.id}: Debounce=0, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –∑–∞—Ç—Ä–∏–º–∫–∏ 30—Å –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ —Ñ–ª–∞–ø–ø—ñ–Ω–≥—É`);
} else {
  debounceMs = debounceMinutes * 60 * 1000;
  console.log(`User ${user.id}: –û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ ${newState} –ø—Ä–æ—Ç—è–≥–æ–º ${debounceMinutes} —Ö–≤`);
}
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ó–º—ñ–Ω–∏ –≤ `getUserState()`:**
```javascript
userStates.set(userId, {
  currentState: null,
  lastChangeAt: null,
  consecutiveChecks: 0,
  isFirstCheck: true,
  pendingState: null,
  pendingStateTime: null,
  debounceTimer: null,
  instabilityStart: null,
  switchCount: 0,
  lastStableState: null,
  lastStableAt: null,
  lastPingTime: null,
  lastPingSuccess: null,
  lastNotificationAt: null, // ‚Üê –ù–û–í–ï –ü–û–õ–ï
});
```

### 4. –û–Ω–æ–≤–ª–µ–Ω–æ –±–∞–∑—É –¥–∞–Ω–∏—Ö

**–§–∞–π–ª:** `src/database/db.js`

**–ó–º—ñ–Ω–∏ –≤ CREATE TABLE:**
```sql
CREATE TABLE IF NOT EXISTS user_power_states (
  telegram_id TEXT PRIMARY KEY,
  current_state TEXT,
  pending_state TEXT,
  pending_state_time TEXT,
  last_stable_state TEXT,
  last_stable_at TEXT,
  instability_start TEXT,
  switch_count INTEGER DEFAULT 0,
  last_notification_at TIMESTAMP, -- ‚Üê –ù–û–í–ê –ö–û–õ–û–ù–ö–ê
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**–î–æ–¥–∞–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é:**
```javascript
// Add last_notification_at column to user_power_states table
try {
  await client.query(`
    ALTER TABLE user_power_states 
    ADD COLUMN IF NOT EXISTS last_notification_at TIMESTAMP
  `);
  console.log(`‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –∫–æ–ª–æ–Ω–∫—É user_power_states.last_notification_at`);
} catch (error) {
  if (!error.message.includes('already exists')) {
    console.error(`‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏ last_notification_at:`, error.message);
  }
}
```

### 5. –û–Ω–æ–≤–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É

**`saveUserStateToDb()`:**
- –î–æ–¥–∞–Ω–æ `last_notification_at` –¥–æ INSERT/UPDATE –∑–∞–ø–∏—Ç—É
- –ü–æ–ª–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ TIMESTAMP

**`restoreUserStates()`:**
- –î–æ–¥–∞–Ω–æ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è `lastNotificationAt: row.last_notification_at`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
```
[20:09:00] üü¢ –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è (–π–æ–≥–æ –Ω–µ –±—É–ª–æ 1 —Ö–≤)
[20:09:05] üî¥ –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ (–≤–æ–Ω–æ –±—É–ª–æ –º–µ–Ω—à–µ —Ö–≤–∏–ª–∏–Ω–∏)
[20:09:10] üü¢ –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è (–π–æ–≥–æ –Ω–µ –±—É–ª–æ –º–µ–Ω—à–µ —Ö–≤–∏–ª–∏–Ω–∏)
```
**–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î 3 —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–∞ 10 —Å–µ–∫—É–Ω–¥!**

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
```
[20:09:00] üü¢ –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è (–π–æ–≥–æ –Ω–µ –±—É–ª–æ 1 —Ö–≤)
```
**–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î 1 —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω!**

–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è:
- `[20:09:05]` —Å—Ç–∞–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `off` ‚Üí pending —Å—Ç–∞–Ω
- `[20:09:10]` —Å—Ç–∞–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `on` ‚Üí —Å–∫–∞—Å–æ–≤—É—î pending, –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –Ω–æ–≤–∏–π pending
- `[20:09:40]` 30 —Å–µ–∫—É–Ω–¥ –º–∏–Ω—É–ª–æ ‚Üí –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î —Å—Ç–∞–Ω `on` ‚Üí **–≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è**

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–π —Ç–µ—Å—Ç: `test-notification-spam-fix.js`

**–†–µ–∑—É–ª—å—Ç–∞—Ç–∏:**
```
‚úÖ –í–°–Ü –¢–ï–°–¢–ò –ü–†–û–ô–î–ï–ù–û –£–°–ü–Ü–®–ù–û!

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏:
   ‚Ä¢ Cooldown –º—ñ–∂ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏: 60 —Å–µ–∫—É–Ω–¥
   ‚Ä¢ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ debounce=0: 30 —Å–µ–∫—É–Ω–¥
   ‚Ä¢ –¢–µ—Å—Ç—ñ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ: 13

‚ú® –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ!
üéØ –¢–µ–ø–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏–º—É—Ç—å –æ–¥–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å —Ç—Ä—å–æ—Ö
```

**–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ –∞—Å–ø–µ–∫—Ç–∏:**
1. ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–ª—è `lastNotificationAt` –≤ –∫–æ–¥—ñ
2. ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ cooldown (60 —Å–µ–∫—É–Ω–¥)
3. ‚úÖ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è (30 —Å–µ–∫—É–Ω–¥)
4. ‚úÖ –õ–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ cooldown
5. ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è `lastNotificationAt` –ø—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
6. ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î
7. ‚úÖ –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –ë–î
8. ‚úÖ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ `getUserState`
9. ‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –ë–î
10. ‚úÖ –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –º–∏—Ç—Ç—î–≤–æ—ó –æ–±—Ä–æ–±–∫–∏ –ø—Ä–∏ debounce=0
11. ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –∑–∞—Ç—Ä–∏–º–∫–∏
12. ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è
13. ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –±–µ–∑ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

## –ë–µ–∑–ø–µ–∫–∞

**CodeQL –∞–Ω–∞–ª—ñ–∑:** ‚úÖ –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π

**Code Review:** ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ –∑ –ø–æ–ª—ñ–ø—à–µ–Ω–Ω—è–º–∏
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≤–∏–Ω–µ—Å–µ–Ω–æ –Ω–∞ —Ä—ñ–≤–µ–Ω—å –º–æ–¥—É–ª—è
- –ü–æ–∫—Ä–∞—â–µ–Ω–æ maintainability

## –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å

–í—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–±–µ—Ä–µ–∂–µ–Ω–æ:
- ‚úÖ –õ–æ–≥—ñ–∫–∞ debounce –¥–ª—è `debounce > 0`
- ‚úÖ –§–æ—Ä–º–∞—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (üü¢/üî¥)
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ `power_notify_target` (bot/channel/both)
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–∏—Ö —à–∞–±–ª–æ–Ω—ñ–≤ `power_on_text`/`power_off_text`
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—ñ–≤ –≤ PostgreSQL
- ‚úÖ –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö/–ø–æ–∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å
- ‚úÖ –ü–æ–∫–∞–∑ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø–æ–¥—ñ—ó –≤ –≥—Ä–∞—Ñ—ñ–∫—É

## –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ

1. **src/powerMonitor.js**
   - –î–æ–¥–∞–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ `NOTIFICATION_COOLDOWN_MS` —Ç–∞ `MIN_STABILIZATION_MS`
   - –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `lastNotificationAt` –¥–æ userState
   - –î–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É cooldown –≤ `handlePowerStateChange()`
   - –ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É debounce=0 –≤ `checkUserPower()`
   - –û–Ω–æ–≤–ª–µ–Ω–æ `saveUserStateToDb()` —Ç–∞ `restoreUserStates()`

2. **src/database/db.js**
   - –î–æ–¥–∞–Ω–æ –∫–æ–ª–æ–Ω–∫—É `last_notification_at TIMESTAMP` –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `user_power_states`
   - –î–æ–¥–∞–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –ë–î

3. **test-notification-spam-fix.js** (–Ω–æ–≤–∏–π)
   - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π —Ç–µ—Å—Ç –Ω–∞ 13 –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
   - –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –∞—Å–ø–µ–∫—Ç—ñ–≤ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

## –í–∏—Å–Ω–æ–≤–æ–∫

–ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å **–ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏—Ä—ñ—à–µ–Ω–∞**:
- üõ°Ô∏è 60-—Å–µ–∫—É–Ω–¥–Ω–∏–π cooldown –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ —Å–ø–∞–º—É
- üõ°Ô∏è 30-—Å–µ–∫—É–Ω–¥–Ω–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –ø—Ä–∏ debounce=0 –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ —Ñ–ª–∞–ø–ø—ñ–Ω–≥—É
- üõ°Ô∏è –°—Ç–∞–Ω –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ –Ω–∞–≤—ñ—Ç—å –±–µ–∑ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
- üõ°Ô∏è –í—Å—ñ –∑–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –ë–î –∑ –º—ñ–≥—Ä–∞—Ü—ñ—î—é

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–µ–ø–µ—Ä –æ—Ç—Ä–∏–º—É—é—Ç—å **–æ–¥–Ω–µ —á—ñ—Ç–∫–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è** –ø—Ä–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω —Å–≤—ñ—Ç–ª–∞ –∑–∞–º—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—É –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤! üéØ
